# План разработки консольного редактора seditor

## 1. Выбор технологий

### Язык программирования
**Рекомендация: Python 3.10+**
- Простота разработки и отладки
- Отличная поддержка работы с терминалом
- Кроссплатформенность (macOS/Linux)
- Богатая экосистема библиотек

**Альтернативы:**
- Rust (высокая производительность, но сложнее разработка)
- Go (баланс между простотой и производительностью)

### Библиотеки
- **blessed** или **rich** + **textual** - для работы с терминалом и создания UI
- **watchdog** - для отслеживания изменений файловой системы
- **asyncio** - для асинхронной обработки автосохранения

## 2. Архитектура приложения

### Компоненты:
1. **Terminal Manager** - управление терминалом, разделение экрана
2. **File Tree Pane (25%)** - дерево файлов с навигацией
3. **Editor Pane (75%)** - основной редактор текста
4. **Command Line Pane** - опциональная командная строка снизу
5. **Key Handler** - обработка всех горячих клавиш
6. **History Manager** - управление историей изменений (undo/redo)
7. **Auto-save Manager** - автоматическое сохранение
8. **Buffer Manager** - управление открытыми файлами

## 3. Структура проекта

```
seditor/
├── src/
│   ├── __init__.py
│   ├── main.py                 # Точка входа
│   ├── terminal/
│   │   ├── __init__.py
│   │   ├── manager.py          # Управление терминалом
│   │   └── layout.py           # Разметка экрана (25/75)
│   ├── components/
│   │   ├── __init__.py
│   │   ├── file_tree.py        # Панель дерева файлов
│   │   ├── editor.py           # Панель редактора
│   │   └── command_line.py     # Командная строка
│   ├── handlers/
│   │   ├── __init__.py
│   │   ├── keyboard.py         # Обработка клавиш
│   │   └── commands.py         # Обработка команд
│   ├── core/
│   │   ├── __init__.py
│   │   ├── history.py          # История изменений (undo/redo)
│   │   ├── buffer.py           # Управление буферами файлов
│   │   └── auto_save.py        # Автосохранение
│   └── utils/
│       ├── __init__.py
│       ├── file_utils.py       # Утилиты для работы с файлами
│       └── text_utils.py       # Утилиты для работы с текстом
├── tests/
│   ├── __init__.py
│   ├── test_editor.py
│   ├── test_history.py
│   └── test_keyboard.py
├── requirements.txt
├── README.md
├── .gitignore
└── setup.py
```

## 4. Этапы разработки

### Этап 1: Базовая инфраструктура
- [ ] Настройка проекта и зависимостей
- [ ] Создание базовой структуры директорий
- [ ] Настройка работы с терминалом (очистка, размеры)
- [ ] Разделение экрана на 25/75
- [ ] Базовое отображение двух панелей

### Этап 2: Панель дерева файлов (25%)
- [ ] Сканирование директории
- [ ] Построение дерева файлов
- [ ] Навигация стрелками вверх/вниз
- [ ] Выделение текущего файла/директории
- [ ] Открытие файлов при Enter
- [ ] Сворачивание/разворачивание директорий

### Этап 3: Панель редактора (75%)
- [ ] Открытие и отображение файла
- [ ] Навигация стрелками (вверх/вниз/влево/вправо)
- [ ] Отображение курсора
- [ ] Прокрутка файла (если больше экрана)
- [ ] Базовое редактирование (ввод текста, удаление)

### Этап 4: Обработка клавиатуры
- [ ] Command+Tab - переключение между панелями
- [ ] Tab - отступы (4 пробела или настраиваемые)
- [ ] Command+C/V - копирование/вставка
- [ ] Option+←/→ - перемещение по словам
- [ ] Option+↑/↓ - выделение блоков по словам
- [ ] Ctrl+Z - отмена изменений
- [ ] Esc - выход из командной строки

### Этап 5: История изменений (Undo/Redo)
- [ ] Реализация стека изменений
- [ ] Сохранение состояния перед каждым действием
- [ ] Ctrl+Z - отмена последнего изменения
- [ ] Ctrl+Shift+Z или Ctrl+Y - повтор изменений
- [ ] Ограничение размера истории (например, 100 действий)

### Этап 6: Работа с текстом
- [ ] Копирование выделенного текста в буфер обмена
- [ ] Вставка из буфера обмена
- [ ] Выделение текста (мышью и клавиатурой)
- [ ] Выделение блоков по словам (Option+↑/↓)

### Этап 7: Автосохранение
- [ ] Отслеживание времени последнего изменения
- [ ] Таймер на 5 секунд после паузы редактирования
- [ ] Автоматическое сохранение в файл
- [ ] Индикатор состояния сохранения (опционально)

### Этап 8: Командная строка
- [ ] Строка ввода снизу экрана
- [ ] Активация по горячей клавише (например, `:`)
- [ ] Выполнение bash-команд
- [ ] Отображение вывода команды
- [ ] Возврат в режим редактирования

### Этап 9: Полировка и оптимизация
- [ ] Обработка ошибок
- [ ] Логирование
- [ ] Оптимизация производительности для больших файлов
- [ ] Поддержка разных кодировок
- [ ] Синтаксическая подсветка (опционально, для будущего)

### Этап 10: Тестирование и документация
- [ ] Написание unit-тестов
- [ ] Тестирование на macOS
- [ ] Подготовка к портированию на Linux Debian
- [ ] Написание README с инструкциями
- [ ] Примеры использования

## 5. Детали реализации

### Работа с терминалом на macOS
- Использование библиотеки `blessed` для:
  - Определения размеров терминала
  - Обработки клавиатурных событий (включая Command, Option)
  - Управления курсором и цветом

### Разделение экрана 25/75
```python
term_width = terminal.width
tree_width = int(term_width * 0.25)
editor_width = term_width - tree_width - 1  # -1 для разделителя
```

### Переключение фокуса (Command+Tab)
- Флаг `focused_pane` ('tree' | 'editor' | 'command')
- Разные обработчики клавиш в зависимости от фокуса
- Визуальное выделение активной панели

### История изменений
- Стек из состояний текста (list of strings)
- При каждом изменении - копия текущего состояния в стек
- Undo: pop из стека, Redo: push обратно

### Автосохранение
- Асинхронная задача (asyncio)
- Отслеживание последнего изменения (timestamp)
- Сохранение через 5 секунд простоя

### Буфер обмена (macOS)
- Использование `pyperclip` или нативного `pbcopy`/`pbpaste`
- Для Command+C: чтение выделенного текста
- Для Command+V: вставка в позицию курсора

## 6. Возможные сложности

1. **Обработка Command/Option на macOS** - могут отличаться от стандартных Ctrl
2. **Размеры терминала** - обработка изменения размеров окна
3. **Производительность больших файлов** - оптимизация отрисовки
4. **Кодировки** - поддержка UTF-8, CP1251 и др.
5. **Буфер обмена** - кроссплатформенность копирования/вставки

## 7. Приоритеты

### MVP (Минимально жизнеспособный продукт):
1. Разделение экрана 25/75
2. Дерево файлов с навигацией
3. Базовое редактирование
4. Command+Tab переключение
5. Стрелки для навигации
6. Tab для отступов

### Вторая очередь:
7. Копирование/вставка
8. История изменений
9. Option+стрелки для работы со словами

### Третья очередь:
10. Автосохранение
11. Командная строка
12. Полировка UI

## 8. Подготовка к Linux

Для будущего портирования на Linux Debian:
- Абстракция работы с терминалом
- Абстракция работы с буфером обмена
- Использование кроссплатформенных библиотек
- Тестирование на Linux до релиза

# ??????????? prompt_toolkit ??? seditor

## 1. ????????? ?????????? ?????? ?

**??, ????? ???????? ???? ??????????!**

### KeyBindings ? prompt_toolkit

`prompt_toolkit` ????? ?????? ??????? `KeyBindings`, ??????? ????????????:
- ????? ?????????? ?????? (Ctrl, Alt/Option, Shift, Meta/Command)
- ????????? ??????????? ??? ?????? ??????????
- ?????? ???????? ??? ?????? ???????/???????
- ???????? ?? macOS/Linux/Windows

### ??????: ????????? ??????????

```python
from prompt_toolkit.key_binding import KeyBindings
from prompt_toolkit import Application
from prompt_toolkit.keys import Keys

# ???????? KeyBindings
kb = KeyBindings()

# Command+Tab ??? ???????????? ???????
@kb.add('c-tab', eager=True)  # 'c' = Ctrl, ??? Command ????? ?????? ??????
def switch_pane(event):
    app.switch_pane()
    event.app.invalidate()

# Option+Left/Right ??? ??????????? ?? ??????
@kb.add('escape', 'b')  # Option+Left ?? macOS
def move_word_left(event):
    buffer = event.app.current_buffer
    buffer.cursor_left(count=1)  # ??? buffer.start_of_word()

@kb.add('escape', 'f')  # Option+Right ?? macOS
def move_word_right(event):
    buffer = event.app.current_buffer
    buffer.cursor_right(count=1)  # ??? buffer.end_of_word()

# Shift+Arrows ??? ?????????
@kb.add('s-left')
def select_left(event):
    buffer = event.app.current_buffer
    buffer.selection_state.enter_shift_mode()
    buffer.cursor_left()

# Command+C/V ??? ???????????/???????
@kb.add('c-c')
def copy_text(event):
    # ???? ?????? ???????????
    pass

@kb.add('c-v')
def paste_text(event):
    # ???? ?????? ???????
    pass

# ???????? ?????????? ? ?????????? ??????????
app = Application(
    key_bindings=kb,
    # ... ?????? ?????????
)
```

### ????????? macOS-??????????? ??????

??? macOS (Command, Option) `prompt_toolkit` ????????????? ???????????? ??????????? ??????????:

```python
# Option+Left/Right ?????? ???????? ?? ???????
# ?? ????? ????????? ????:
from prompt_toolkit.keys import Keys

@kb.add(Keys.Left, filter=...)  # ??????? ?????
@kb.add(Keys.Right, filter=...)  # ??????? ??????

# ??? Option+??????? ????? ???????????? ???????
from prompt_toolkit.filters import Condition

@kb.add(Keys.Left, filter=option_pressed)
def word_left(event):
    ...
```

### ?????? ???????? ??? ?????? ???????

```python
# ???????? ??? ?????? ??????
tree_kb = KeyBindings()

@tree_kb.add('enter')
def enter_directory(event):
    # ???? ??????
    pass

# ???????? ??? ?????????
editor_kb = KeyBindings()

@editor_kb.add('c-s')
def save_file(event):
    # ???? ??????
    pass

# ????? ?????????? ????????
all_kb = KeyBindings()
all_kb.update(tree_kb)
all_kb.update(editor_kb)
```

---

## 2. ????????? ?????????? ?

**??, ????? ???????? ????????? ??????????!**

### Pygments ? prompt_toolkit

`prompt_toolkit` ????? ?????????? ????????? **Pygments** - ????? ?????????? ?????????? ??? ????????? ?????????? ? Python.

### ??????: ????????? ??????????

```python
from prompt_toolkit.lexers import PygmentsLexer
from prompt_toolkit.layout.containers import Window
from prompt_toolkit.layout.controls import BufferControl
from pygments.lexers import PythonLexer, JavascriptLexer, get_lexer_by_name

# ??????????? ??????? ?? ?????? ?????????? ?????
def get_lexer_for_file(file_path: str):
    ext = file_path.split('.')[-1]
    lexer_map = {
        'py': PythonLexer(),
        'js': JavascriptLexer(),
        'jsx': JavascriptLexer(),
        'ts': get_lexer_by_name('typescript'),
        'tsx': get_lexer_by_name('tsx'),
        'html': get_lexer_by_name('html'),
        'css': get_lexer_by_name('css'),
        'json': get_lexer_by_name('json'),
        'yaml': get_lexer_by_name('yaml'),
        'yml': get_lexer_by_name('yaml'),
        'md': get_lexer_by_name('markdown'),
        'sh': get_lexer_by_name('bash'),
        'bash': get_lexer_by_name('bash'),
        # ... ? ?.?.
    }
    return lexer_map.get(ext, None)

# ????????????? ??????? ? ?????????
def create_editor(buffer, file_path: str):
    lexer = get_lexer_for_file(file_path)
    
    if lexer:
        # ? ?????????? ??????????
        control = BufferControl(
            buffer=buffer,
            lexer=PygmentsLexer(lexer)
        )
    else:
        # ??? ????????? (??????? ?????)
        control = BufferControl(buffer=buffer)
    
    return Window(control)
```

### ???????????? ???????????? ???????

```python
from prompt_toolkit.lexers import DynamicLexer

# ???????????? ??????, ??????? ???????? ? ??????????? ?? ?????
class FileLexer(DynamicLexer):
    def __init__(self, file_path_callback):
        """
        file_path_callback - ???????, ??????? ?????????? ??????? ???? ? ?????
        """
        self.get_file_path = file_path_callback
        
    def get_lexer(self):
        file_path = self.get_file_path()
        if file_path:
            lexer = get_lexer_for_file(file_path)
            if lexer:
                return PygmentsLexer(lexer)
        return None

# ?????????????
editor_buffer = Buffer()

def get_current_file():
    return app.current_file_path

control = BufferControl(
    buffer=editor_buffer,
    lexer=FileLexer(get_current_file)
)
```

### ????????? ???

```python
from prompt_toolkit.styles import Style
from pygments.styles import get_style_by_name

# ????????????? ???? Pygments
style = Style.from_dict({
    # ????? ?????????????? ?????
    'pygments.keyword': '#FF0000 bold',
    'pygments.string': '#00FF00',
    # ... ? ?.?.
})

# ??? ???????????? ??????? ????
from pygments.styles import get_style_by_name
style = get_style_by_name('monokai')  # ??? 'vs', 'github', 'emacs', etc.

app = Application(
    style=style,
    # ...
)
```

### ????????? ?????

```python
from prompt_toolkit.styles import Style

custom_style = Style([
    ('editor', 'bg:#1e1e1e fg:#d4d4d4'),  # ??? ? ????? ?????????
    ('editor.line-number', '#858585'),     # ?????? ?????
    ('editor.cursor', 'bg:#aeafad'),       # ??????
    ('editor.selection', 'bg:#264f78'),    # ?????????
    ('pygments.keyword', '#569cd6'),       # ???????? ?????
    ('pygments.string', '#ce9178'),        # ??????
    ('pygments.comment', '#6a9955'),       # ???????????
    # ... ? ?.?.
])

app = Application(style=custom_style)
```

### ??????: ??????????????????? ???????? ? ??????????

```python
from prompt_toolkit import Application
from prompt_toolkit.buffer import Buffer
from prompt_toolkit.layout.containers import Window, HSplit
from prompt_toolkit.layout.controls import BufferControl, FormattedTextControl
from prompt_toolkit.lexers import PygmentsLexer
from prompt_toolkit.key_binding import KeyBindings
from prompt_toolkit.layout import Layout
from pygments.lexers import PythonLexer

# ????? ? ???????
buffer = Buffer()
buffer.text = """
def hello_world():
    print("Hello, World!")
    return True
"""

# ???????? ????????? ? ??????????
editor = Window(
    BufferControl(
        buffer=buffer,
        lexer=PygmentsLexer(PythonLexer()),  # ????????? Python
        line_numbers=True,  # ?????? ????? ??????????!
    ),
    wrap_lines=False,
)

# Layout
layout = Layout(editor)

# KeyBindings
kb = KeyBindings()

@kb.add('c-s')
def save(event):
    # ?????????? ?????
    print(f"??????????: {buffer.text}")
    event.app.exit()

# ??????????
app = Application(
    layout=layout,
    key_bindings=kb,
    full_screen=True,
)

if __name__ == '__main__':
    app.run()
```

---

## ?????

### ? ????????? ?????????? ??????
- **??**, ????? ???????? ????? ?????????? ????? `KeyBindings`
- ????????? Ctrl, Alt/Option, Shift, Meta/Command
- ?????? ???????? ??? ?????? ???????/???????
- ???????? ????????? macOS

### ? ????????? ??????????
- **??**, ????? ???????? ????? `PygmentsLexer`
- ????????? 300+ ?????? ????????????????
- ?????? ??????? ??? ? ??????
- ???????????? ???????????? ??????? ? ??????????? ?? ?????

### ????????? ????????????

```bash
# ??? ????????? ?????????? ????? pygments
poetry add prompt-toolkit pygments
```

---

## ????????????

**prompt_toolkit** ????????? ???????? ??? ?????? ???????:
1. ? ????????? ?????????? ?????? (Command+Tab, Option+???????, Shift+???????, ? ?.?.)
2. ? ????????? ?????????? (????? ???????? ?????, ????? ????? ?????)
3. ? ????????? ?????? (??????????)
4. ? Undo/Redo (??????????)
5. ? ?????? ????? (??????????)
6. ? ???????? ????????? macOS

????? ?????? ???????? ?? `prompt_toolkit`? ??? ????????? ????? ??????? ?? ?????????? ??????? ??????? ??????????????!

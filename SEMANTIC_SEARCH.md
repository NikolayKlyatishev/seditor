# Семантический поиск файлов в Seditor 2.0

## Обзор

Версия 2.0 добавляет мощный семантический поиск по файлам проекта. Теперь вы можете искать файлы не только по имени, но и по их содержимому, используя естественные языковые запросы.

## Возможности

- **Семантический поиск**: Ищите файлы по смыслу, а не только по точному совпадению текста
- **Автоматическая индексация**: При входе в каталог (Enter) система автоматически создаёт индекс
- **Локальная работа**: Использует локальную модель `sentence-transformers/all-MiniLM-L6-v2` - не требует интернета
- **Быстрый поиск**: ChromaDB обеспечивает мгновенный поиск среди тысяч файлов
- **Интеграция с деревом**: При выборе файла автоматически раскрывается путь в дереве каталогов

## Установка зависимостей

```bash
poetry install
```

Будут установлены:
- `chromadb` - векторная база данных
- `sentence-transformers` - модели для эмбеддингов
- `torch` - PyTorch для работы моделей

## Использование

### 1. Индексация проекта

1. Запустите `seditor`
2. В дереве файлов выберите нужную директорию
3. Нажмите **Enter** для входа в директорию
4. Система автоматически создаст каталог `.seditor/` и начнёт индексацию
5. Прогресс отображается в статус-баре: "Индексация: 45/120 файлов"

### 2. Поиск файлов

1. Нажмите **Ctrl+P** для открытия командной палитры
2. Выберите **"Поиск файлов (Search)"** (первый пункт)
3. Введите описание того, что ищете, например:
   - "файловое дерево"
   - "обработка команд"
   - "редактор текста"
   - "semantic search implementation"
4. Система покажет top-10 наиболее релевантных файлов
5. Используйте **↑/↓** для навигации, **Enter** для открытия файла
6. **Escape** для отмены

### 3. Переиндексация

Если вы добавили новые файлы или изменили существующие:

1. Нажмите **Ctrl+P**
2. Выберите **"Переиндексировать (Reindex)"**
3. Дождитесь завершения индексации

## Что индексируется

### Поддерживаемые форматы файлов

- **Код**: `.py`, `.js`, `.ts`, `.jsx`, `.tsx`, `.java`, `.go`, `.rs`, `.cpp`, `.c`, `.h`, `.rb`, `.php`, `.swift`, `.kt`
- **Веб**: `.html`, `.css`, `.scss`, `.sass`
- **Конфиги**: `.json`, `.yaml`, `.yml`, `.toml`, `.ini`, `.conf`
- **Документация**: `.md`, `.txt`
- **Скрипты**: `.sh`, `.bash`

### Что игнорируется

- Бинарные файлы
- Файлы больше 1MB
- Директории: `.git`, `node_modules`, `__pycache__`, `venv`, `.venv`, `dist`, `build`, `.seditor`

## Технические детали

### Архитектура

```
.seditor/
└── chroma_db/          # Векторная база данных ChromaDB
    ├── index/          # Индексы для быстрого поиска
    └── data/           # Эмбеддинги и метаданные
```

### Модель эмбеддингов

Используется `all-MiniLM-L6-v2`:
- Размер: ~80MB
- Скорость: ~1000 документов/сек
- Качество: отличное для большинства задач
- Поддержка: многоязычность (включая русский)

### Производительность

- **Индексация**: ~50-100 файлов/сек (зависит от размера)
- **Поиск**: <100ms для коллекции из 1000+ файлов
- **Память**: ~200MB для модели + ~1KB на файл в индексе

## Примеры запросов

### Поиск по функциональности
- "обработка клавиш" → найдёт файлы с key bindings
- "рендеринг интерфейса" → найдёт UI компоненты
- "работа с файлами" → найдёт file I/O код

### Поиск по концепциям
- "автосохранение" → найдёт autosave логику
- "тема оформления" → найдёт theme/style файлы
- "логирование ошибок" → найдёт error handling

### Поиск по технологиям
- "prompt toolkit" → найдёт PTK интеграцию
- "pygments syntax" → найдёт код подсветки синтаксиса
- "asyncio background tasks" → найдёт асинхронный код

## Устранение неполадок

### Ошибка "Failed to load model"

Убедитесь, что установлены все зависимости:
```bash
poetry install
```

### Медленная индексация

- Проверьте размер проекта (большие проекты индексируются дольше)
- Убедитесь, что `.gitignore` правильно настроен
- Исключите ненужные директории

### Поиск не находит файлы

- Убедитесь, что индексация завершена
- Попробуйте переиндексировать (Ctrl+P → Reindex)
- Проверьте, что файл имеет поддерживаемое расширение

## Ограничения

- Индексируются только текстовые файлы
- Максимальный размер файла: 1MB
- Для больших файлов (>100KB) индексируются первые 50KB
- Индекс хранится локально в `.seditor/` (добавлен в `.gitignore`)

## Производительность и оптимизация

### Рекомендации

1. **Первый запуск**: Индексация займёт время, но выполняется только один раз
2. **Обновления**: Используйте Reindex только при значительных изменениях
3. **Размер проекта**: Оптимально для проектов до 10,000 файлов
4. **Память**: Рекомендуется минимум 2GB RAM

## Будущие улучшения

- [ ] Инкрементальная индексация (отслеживание изменений)
- [ ] Поддержка дополнительных форматов файлов
- [ ] Настраиваемые фильтры индексации
- [ ] Экспорт/импорт индексов
- [ ] Статистика использования поиска

---

**Версия**: 2.0  
**Дата**: Ноябрь 2025

